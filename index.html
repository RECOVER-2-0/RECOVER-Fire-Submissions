
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>RECOVER 2.0: Community Submitted Fires</title>
    <link rel="icon" type="image/x-icon" href="https://www.isu.edu/media/top-level/images/favicon.ico">

    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css">
    <link rel="stylesheet" href="index.css">
    
    <!-- START ARCADE EXPRESSIONS -->
    <script type = "text/plain" id="state">
      if (IsEmpty(Geometry($feature))) {
        return;
      }
      var states = Intersects(FeatureSetByName($map, "Western States"), $feature);
      
      if (IsEmpty(states)) {
        return null;
      } 
      
      if (Count(states) == 1) {
        var state = First(states);
        return state.STATE_ABBR;
      } else {
        var largest = -1;
        var result;

        for (var state in states) {
          var size = Area(Intersection($feature, state));

          if (size > largest) {
            largest = size;
            result = state.STATE_ABBR;
          }
        }
        return result;
      }
    </script>
    
    <script type="text/plain" id="nearest-city">
      if (isEmpty(Geometry($feature))) {
        return;
      }
      
      // Buffer distance in miles 
      var bufferDist = 300;
      var bufferGeom = Buffer($feature, bufferDist, "miles")
      
      // Find nearby major cities
      var cities = Intersects(FeatureSetByName($map, "Cities", ["NAME"], true), bufferGeom);
      
      // return if no results
      if (Count(cities) == 0) {
        return null;
      }
      
      var nearestCity
      var minDistance = Infinity;
      
      // iterate through city points
      for (var city in cities) {
        var cityDistance = Distance(city, $feature, "miles");
        
        if (cityDistance < minDistance) {
          nearestCity = city;
          minDistance = cityDistance;
        }
      }
      
      // return city name from nearest city
      return Proper(nearestCity.NAME);
    </script>
    
    <script type = "text/plain" id="uid">
      if (IsEmpty($feature.State) || IsEmpty($feature.Fire_Name) || IsEmpty($feature.Fire_Year)) {
        return;
      }
      var fYear = $feature.Fire_Year;
      var stateAbbr = $feature.State;
      var nameSubstr = Left($feature.Fire_Name, 3);
      var subPre = "SUB_";
      
      var uniqueID = Upper(Concatenate([subPre, fYear, "_", stateAbbr, nameSubstr]));
      
      return uniqueID;
    </script>

    <script type = "text/plain" id="validation">

      var subEmail = $feature.Sub_Email;
      
      var banned = [33,35,36,37,38,39,42,43,45,47,61,63,94,95,96,123,124,125,126,34,40,41,44,58,59,60,62,91,92,93];
      var tlds = [".com", ".org", ".net", ".int", ".edu", ".gov", ".mil"];

      var inEmail = [];
      for (var char in subEmail) {
        var inEmailCC = ToCharCode(subEmail, char)
        Push(inEmail, inEmailCC)
      };

      for (var char in inEmail) {
        if (Includes(banned, inEmail[char])) {
          return "Invalid";
        }
      };
      
      if (IsEmpty(subEmail)) {
        return "Invalid";
      }
      

      return "Valid";

    </script>

    <!-- END ARCADE EXPRESSIONS -->

  </head>
  <body>
    <div class="header">
      <img src="https://www.arcgis.com/sharing/rest/content/items/18fb54a427d449c08dc79ba4a650d636/resources/images/widget_159/1683741702207.png" alt="NASA RECOVER 2.0 logo"/>Community Fire Submissions
    </div>
    <div id="viewDiv">
    </div>
    <script type ="module" src="/index.js"></script>
  </body>
</html>

